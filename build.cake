#addin nuget:?package=YUICompressor.NET
#addin nuget:?package=EcmaScript.Net
#addin "Cake.FileHelpers"
#addin Cake.XdtTransform

using Yahoo.Yui.Compressor;
using System.Text.RegularExpressions;
using System.Security.Cryptography;

//////////////////////////////////////////////////////////////////////
// ARGUMENTS
//////////////////////////////////////////////////////////////////////

var target = Argument("target", "Default");
var configuration = Argument("configuration", "Release");
var buildName = EnvironmentVariable("BUILD_BUILDNUMBER") 
  ?? Argument("buildnumber", "Test-" + DateTime.Now.ToString("yyyy.MM.dd.HHmm") + "-Stuff");

//////////////////////////////////////////////////////////////////////
// PREPARATION
//////////////////////////////////////////////////////////////////////

// Define directories.
var buildDir = Directory("./artifacts/");

//////////////////////////////////////////////////////////////////////
// TASKS
//////////////////////////////////////////////////////////////////////

Task("Clean")
  .Does(() =>
{
  CleanDirectory(buildDir);
});

Task("Zip-Artifacts")
  .IsDependentOn("Clean")
  .Does(() => 
{
  Zip("./src/", "./artifacts/short-of-the-week.zip");
});

//////////////////////////////////////////////////////////////////////
// TASK TARGETS
//////////////////////////////////////////////////////////////////////

Task("Default")
  .IsDependentOn("Zip-Artifacts");

//////////////////////////////////////////////////////////////////////
// EXECUTION
//////////////////////////////////////////////////////////////////////

RunTarget(target);